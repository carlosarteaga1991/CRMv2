{% load static %}
{% load humanize %}
{% load widget_tweaks %}


  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-dark navbar-primary"  style="position:fixed; width:100%; background: #6CA3FC; font-size: 13px; height: 32px; display: flex; justify-content: center;" >
    <!--<div class="container">-->
      <a href="#" class="navbar-brand" style="font-size: 16px;">
        <img src="{% static 'lib/adminlte-3.0.5/img/AdminLTELogo.png' %}" alt="SoftArteaga" class="brand-image img-circle elevation-3" style="opacity: .8; width:30px; height: 25px;">
        
        <!--<span class="brand-text font-weight-light">SoftArteaga</span>-->
      </a>
      
      <button class="navbar-toggler order-1" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button> 

      <div class="collapse navbar-collapse order-3" id="navbarCollapse" >
        <!-- Left navbar links -->
        
        <ul class="navbar-nav" >
          <li class="nav-item">
            <a href="{% url 'crm:dashboard'%}" class="nav-link"><strong>Home</strong></a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link"><strong>Gestiones</strong></a>
          </li>
          <li class="nav-item dropdown">
            <a id="dropdownSubMenu1" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="nav-link dropdown-toggle"><strong>Administración</strong></a>
            <ul aria-labelledby="dropdownSubMenu1" class="dropdown-menu border-0 shadow" style="font-size: 12px;">

              <!-- INICIO Módulo de seguridad-->
                {% if permisos.usuario_administrador == True or context.permisos.usuario_administrador == True %}
                      <li class="dropdown-submenu dropdown-hover ">
                        <a id="dropdownSubMenu2" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-item dropdown-toggle">Módulo de Segurdad</a>
                        <ul aria-labelledby="dropdownSubMenu2" class="dropdown-menu border-0 shadow" style="font-size: 12px;">
                          <li><a href="{% url 'listar_roles' %}" class="dropdown-item">Perfiles</a></li>
                          <!--<div class="dropdown-divider"></div>-->
                          <li><a href="{% url 'listar_permisos'%}" class="dropdown-item">Permisos </a></li>
                          <!--<div class="dropdown-divider"></div>-->
                          <li ><a href="{% url 'listar_usuarios' %}" class="dropdown-item" >Usuarios </a></li>
                          <!--<div class="dropdown-divider"></div>-->
                          <li ><a href="#" class="dropdown-item" >Bitácoras/Auditoría </a></li>
                        </ul>
                      </li>
                {% else %}
                  {% for x in permisos.permisos_usuario %}
                  {% if x.pantalla_id == 20 and x.ver == 1 %}
                  <!--<div class="dropdown-divider"></div>-->
                  <li class="dropdown-submenu dropdown-hover ">
                    <a id="dropdownSubMenu2" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-item dropdown-toggle">Módulo de Segurdad</a>
                    <ul aria-labelledby="dropdownSubMenu2" class="dropdown-menu border-0 shadow" style="font-size: 12px;">
                    {% for xx in permisos.permisos_usuario %}
                        {% if xx.pantalla_id == 1 and xx.ver == 1 and xx.estado == '1' %}
                      <li><a href="{% url 'listar_roles' %}" class="dropdown-item">Perfiles</a></li>
                      <!--<div class="dropdown-divider"></div>-->
                      {% endif %}
                      {% if xx.pantalla_id == 2 and xx.ver == 1 and xx.estado == '1' %}
                      <li><a href="{% url 'listar_permisos'%}" class="dropdown-item">Permisos </a></li>
                      <!--<div class="dropdown-divider"></div>-->
                      {% endif %}
                      {% if xx.pantalla_id == 3 and xx.ver == 1 and xx.estado == '1' %}
                      <li ><a href="{% url 'listar_usuarios' %}" class="dropdown-item" >Usuarios </a></li>
                      <!--<div class="dropdown-divider"></div>-->
                      {% endif %}
                      {% if xx.pantalla_id == 4 and xx.ver == 1 and xx.estado == '1' %}
                      <li ><a href="#" class="dropdown-item" >Bitácoras/Auditoría </a></li>
                      {% endif %}
                      {% endfor %}
                    </ul>
                  </li>
                  <!--<div class="dropdown-divider"></div>-->
                  {% endif %}
                  {% endfor %}
                {% endif %}
                  
              <!-- FIN Módulo de seguridad -->

              

              <!-- INICIO Módulo de gerencial-->
                  {% if permisos.usuario_administrador == True or context.permisos.usuario_administrador == True %}
                    <!--<div class="dropdown-divider"></div>-->
                  
                  <li class="dropdown-submenu dropdown-hover ">
                    <a id="dropdownSubMenu2" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-item dropdown-toggle">Módulo Gerencial</a>
                    <ul aria-labelledby="dropdownSubMenu2" class="dropdown-menu border-0 shadow" style="font-size: 12px;"> 
                            <li ><a href="{% url 'crm:listar_departamento' %}" class="dropdown-item" >Departamentos </a></li>
                            <!--<div class="dropdown-divider"></div>-->
                          <li><a href="{% url 'crm:listar_puestos' %}" class="dropdown-item">Puestos</a></li>
                          <!--<div class="dropdown-divider"></div>-->
                          <li><a href="{% url 'crm:listar_empresa' %}" class="dropdown-item">Empresas</a></li>
                          <!--<div class="dropdown-divider"></div>-->
                          <li><a href="#" class="dropdown-item">KPI</a></li>
                          <!--<div class="dropdown-divider"></div>-->
                    </ul>
                  </li>
      
                  {% else %}

                  {% for x in permisos.permisos_usuario %}
                  {% if  x.pantalla_id == 21 and x.ver == 1  %}
                  
                  
                  <li class="dropdown-submenu dropdown-hover ">
                    <a id="dropdownSubMenu2" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-item dropdown-toggle">Módulo Gerencial</a>
                    <ul aria-labelledby="dropdownSubMenu2" class="dropdown-menu border-0 shadow" style="font-size: 12px;"> 
                        {% for xx in permisos.permisos_usuario %}
                        {% if xx.pantalla_id == 5 and xx.ver == 1 and xx.estado == '1' %}
                            <li ><a href="{% url 'crm:listar_departamento' %}" class="dropdown-item" >Departamentos </a></li>
                            <!--<div class="dropdown-divider"></div>-->
                        {% endif %}
                        {% if xx.pantalla_id == 6 and xx.ver == 1  and xx.estado == '1' %}
                          <li><a href="{% url 'crm:listar_puestos' %}" class="dropdown-item">Puestos</a></li>
                          <!--<div class="dropdown-divider"></div>-->
                          {% endif %}
                        {% if xx.pantalla_id == 7 and xx.ver == 1  and xx.estado == '1' %}
                          <li><a href="{% url 'crm:listar_empresa' %}" class="dropdown-item">Empresas</a></li>
                          <!--<div class="dropdown-divider"></div>-->
                          {% endif %}
                        {% if xx.pantalla_id == 8 and xx.ver == 1 and xx.estado == '1' %}
                          <li><a href="#" class="dropdown-item">KPI</a></li>
                          <!--<div class="dropdown-divider"></div>-->
                          {% endif %}
                        {% endfor %}
                    </ul>
                  </li>
                  {% endif %}
                  {% endfor %}

                  {% endif %}

              
              <!-- FIN Módulo de gerencial -->
              
              

              <!-- INICIO Módulo de cobros-->
                {% if permisos.usuario_administrador == True or context.permisos.usuario_administrador == True %}
                  <!--<div class="dropdown-divider"></div>-->
                    <li class="dropdown-submenu dropdown-hover ">
                    <a id="dropdownSubMenu2" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-item dropdown-toggle">Módulo de Cobros</a>
                    <ul aria-labelledby="dropdownSubMenu2" class="dropdown-menu border-0 shadow" style="font-size: 12px;">
                      <li><a href="{% url 'crm:listar_cliente' %}" class="dropdown-item">Clientes</a></li>
                      <!--<div class="dropdown-divider"></div>-->
                      <li><a href="{% url 'crm:listar_codigos' %}" class="dropdown-item">Códigos</a></li>
                      <!--<div class="dropdown-divider"></div>-->
                      <li><a href="{% url 'crm:listar_motivos' %}" class="dropdown-item">Motivos</a></li>
                      <!--<div class="dropdown-divider"></div>-->
                      <li class="dropdown-submenu dropdown-hover ">
                      <a id="dropdownSubMenu2" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-item dropdown-toggle">Seguimiento</a>
                      <ul aria-labelledby="dropdownSubMenu2" class="dropdown-menu border-0 shadow" style="font-size: 12px;">
                        <li><a tabindex="-1" href="{% url 'crm:listar_seg_promesas'%}" class="dropdown-item">Promesas</a></li>
                        <!--<div class="dropdown-divider"></div>-->
                        <li><a href="{% url 'crm:listar_seg_visita' %}" class="dropdown-item">Visitas</a></li>
                        <!--<div class="dropdown-divider"></div>-->
                        <li><a href="{% url 'crm:listar_seg_alertas' %}" class="dropdown-item">Alertas</a></li>
                      </ul>
                  </li>
                    </ul>
                  </li>
                {% else %}
                      {% for x in permisos.permisos_usuario  %}
                        {% if x.pantalla_id == 22 and x.ver == 1 %}
                          <!--<div class="dropdown-divider"></div>-->
                            <li class="dropdown-submenu dropdown-hover ">
                            <a id="dropdownSubMenu2" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-item dropdown-toggle">Módulo de Cobros</a>
                            <ul aria-labelledby="dropdownSubMenu2" class="dropdown-menu border-0 shadow" style="font-size: 12px;">
                              {% for xx in permisos.permisos_usuario %}
                                  {% if xx.pantalla_id == 9 and xx.ver == 1 and xx.estado == '1' %}
                                      <li><a href="{% url 'crm:listar_cliente' %}" class="dropdown-item">Clientes</a></li>
                                      <!--<div class="dropdown-divider"></div>-->
                                      {% endif %}
                                      {% if xx.pantalla_id == 23 and xx.ver == 1 and xx.estado == '1' %}
                                      <li><a href="{% url 'crm:listar_codigos' %}" class="dropdown-item">Códigos</a></li>
                                      <!--<div class="dropdown-divider"></div>-->
                                      {% endif %}
                                      {% if xx.pantalla_id == 24 and xx.ver == 1 and xx.estado == '1' %}
                                        <li><a href="{% url 'crm:listar_motivos' %}" class="dropdown-item">Motivos</a></li>
                                        <!--<div class="dropdown-divider"></div>-->
                                        {% endif %}

                                        {% if xx.pantalla_id == 27 %}
                                        <li class="dropdown-submenu dropdown-hover ">
                                        <a id="dropdownSubMenu2" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-item dropdown-toggle">Seguimiento</a>
                                            <ul aria-labelledby="dropdownSubMenu2" class="dropdown-menu border-0 shadow" style="font-size: 12px;">
                                            {% for v in permisos.permisos_usuario %}
                                                {% if v.pantalla_id == 17 and v.ver == 1 and v.estado == '1' %}
                                                <li><a tabindex="-1" href="{% url 'crm:listar_seg_promesas'%}" class="dropdown-item">Promesas</a></li>
                                                <!--<div class="dropdown-divider"></div>-->
                                                {% endif %}
                                                {% if v.pantalla_id == 18 and v.ver == 1 and v.estado == '1'%}
                                                <li><a href="{% url 'crm:listar_seg_visita' %}" class="dropdown-item">Visitas</a></li>
                                                <!--<div class="dropdown-divider"></div>-->
                                                {% endif %}
                                                {% if v.pantalla_id == 19 and v.ver == 1 and v.estado == '1'%}
                                                <li><a href="{% url 'crm:listar_seg_alertas' %}" class="dropdown-item">Alertas</a></li>
                                                {% endif %}
                                              {% endfor %}
                                            </ul>
                                        </li>
                                        {% endif %}
                              {% endfor %}
                              </ul>
                              </li>
                        {% endif %}
                      {% endfor %}
                {% endif %}
                
              <!-- FIN Módulo de cobros -->

              
              

              

              <!-- INICIO MÓDULO DE MONITOREO-->
                  {% if permisos.usuario_administrador == True or context.permisos.usuario_administrador == True %}
                  <li class="dropdown-divider"></li>
                    <li class="dropdown-submenu dropdown-hover ">
                      <a id="dropdownSubMenu2" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-item dropdown-toggle">Módulo de Monitoreo</a>
                      <ul aria-labelledby="dropdownSubMenu2" class="dropdown-menu border-0 shadow" style="font-size: 12px;">
                        <li><a tabindex="-1" href="" class="dropdown-item">Empleados</a></li>
                        <!--<div class="dropdown-divider"></div>-->
                        <li><a href="" class="dropdown-item">Pagos</a></li>
                        <!--<div class="dropdown-divider"></div>-->
                        <li><a href="" class="dropdown-item">Promesas</a></li>
                      </ul>
                    </li>
                  {% else %}
                    {% for x in permisos.permisos_usuario  %}
                      {% if x.pantalla_id == 25 and x.ver == 1 %}
                      <!--<div class="dropdown-divider"></div>-->
                        <li class="dropdown-submenu dropdown-hover ">
                          <a id="dropdownSubMenu2" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-item dropdown-toggle">Módulo de Monitoreo</a>
                          <ul aria-labelledby="dropdownSubMenu2" class="dropdown-menu border-0 shadow" style="font-size: 12px;">
                            {% for xx in permisos.permisos_usuario %}
                              {% if xx.pantalla_id == 26 and xx.ver == 1 and xx.estado == '1' %}
                              <li><a tabindex="-1" href="" class="dropdown-item">Empleados</a></li>
                              <!--<div class="dropdown-divider"></div>-->
                              {% endif %}
                              {% if xx.pantalla_id == 10 and xx.ver == 1 and xx.estado == '1' %}
                              <li><a href="" class="dropdown-item">Pagos</a></li>
                              <!--<div class="dropdown-divider"></div>-->
                              {% endif %}
                              {% if xx.pantalla_id == 11 and xx.ver == 1 and xx.estado == '1' %}
                              <li><a href="" class="dropdown-item">Promesas</a></li>
                              {% endif %}
                            {% endfor %}
                          </ul>
                        </li>
                      {% endif %}
                    {% endfor %}
                  {% endif %}
                    
              <!-- FIN MÓDULO DE MONITOREO -->
            </ul>
          </li>
        </ul>

        <!-- Para perfil y alertas -->
        <ul class="navbar-nav ml-auto float-left" >
            <!-- Para Alertas -->
            <li class="nav-item ml-auto" >
              <a class="nav-link" data-toggle="dropdown" href="#">
                <i class="far fa-bell"></i>
                {% if context.cont_total == 0 or cont_total == 0 %}
                  <span class="badge badge-warning navbar-badge"></span>
                {% else %}
                  <span class="badge badge-warning navbar-badge"> {{ context.cont_total }} {{ cont_total }}</span>
                {% endif %}

              </a>
              <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right" style="font-size: 12px;">
                <span class="dropdown-header" style="font-size: 12px;">{{ cont_total }} {{ context.cont_total }} Notificaciones</span>
                <div class="dropdown-divider"></div>
                  <a href="{% url 'crm:listar_promesas_hoy' %}" class="dropdown-item">
                    <i class="fas fa-phone-square"></i>&nbsp;&nbsp;&nbsp; &nbsp;Promesas pendientes de hoy
                    <span class="float-right text-muted text-sm"> {{ cont_promesa }} {{ context.cont_promesa }}</span>
                  </a>
                <div class="dropdown-divider"></div>
                <!--<a href="#" class="dropdown-item">
                  <i class="fas fa-headset"></i> &nbsp;&nbsp;&nbsp;&nbsp;Promesas futuras
                  <span class="float-right text-muted text-sm">8 </span>
                </a>-->
                <div class="dropdown-divider"></div>
                <a href="{% url 'crm:listar_alertas_hoy' %}" class="dropdown-item">
                  <i class="fas fa-bell mr-2"></i> &nbsp;&nbsp;Alertas pendientes de hoy
                  <span class="float-right text-muted text-sm">{{ context.cont_alerta }} {{ cont_alerta }} </span>
                </a>
                <!--<div class="dropdown-divider"></div>
                <a href="#" class="dropdown-item dropdown-footer" style="font-size: 12px;">Ver todas las Alertas</a>
                <div class="dropdown-divider"></div>
                <a href="#" class="dropdown-item dropdown-footer" style="font-size: 12px;">Ver todas las Promesas</a>-->
              </div>
              
            </li>
            <!-- /. Para Alertas -->

            <li class="nav-item ml-auto">
                <a class="nav-link" data-toggle="dropdown" href="#">
                    <i class="fas fa-users-cog"></i> {{ request.user.username }} 
                </a><!-- {{ request.user.id }} -->
                <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right" style="font-size: 12px;">
                        <span class="dropdown-header" style="font-size: 12px;">
                            Último Acceso: {{ request.user.last_login }}
                        </span>
                    <div class="dropdown-divider"></div>
                    <a href="{% url 'editar_perfil_usuario' %}" class="dropdown-item">
                        <i class="fas fa-edit mr-2"></i> Editar perfil
                        <span  class="float-right text-muted text-sm" style="font-size: 8px;">Última: {{ request.user.fch_modificacion | naturalday }}</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item">
                        <i class="fas fa-lock mr-2"></i> Editar password
                        <span class="float-right text-muted text-sm">13 hours</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item dropdown-footer" style="font-size: 12px;">
                        <p>Este sistema te permitira realizar diferentes actividades</p>
                    </a>
                </div>
            </li>
          

            <li class="nav-item">
                <a class="nav-link confirmar"><!-- href="{% url 'login:salir' %}"-->
                    <i class="fas fa-power-off" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
        <!-- /. Para perfil y alertas-->

      </div>

      <!-- Right navbar links -->

    <!--</div>-->
        
  </nav>
  <!-- /.navbar -->

  <script>

  // INICIO BOTÓN SALIR
    $('.confirmar').on('click', function () {
    
        var parameters = $(this).serializeArray();
        $.confirm({
        theme: 'material',
        title: 'Confirmación',
        icon: 'fa fa-info',
        content: '¿Seguro que desea salir?',
        columnClass: 'medium',
        typeAnimated: true,
        cancelButtonClass: 'btn-primary',
        draggable: true,
        dragWindowBorder: false,
        buttons: {
            info: {
                text: "Si",
                btnClass: 'btn-primary',
                action: function () {
                    $.ajax({
                        url: "{% url 'login:salir' %}" //window.location.pathname
                        //type: '',
                        //data: parameters
                        //dataType: 'json'
                    }).done(function (data) {
                        //console.log(data);
                        if (!data.hasOwnProperty('error')) {
                            location.href = '/login/';//{{ url_salir }}
                            return false;
                        }
                        //message_error(data.error);
                    }).fail(function (jqXHR, textStatus, errorThrown) {
                        alert(textStatus + ': ' + errorThrown);
                    }).always(function (data) {

                    });
                }
            },
            danger: {
                text: "No",
                btnClass: 'btn-red',
                action: function () {

                }
            },
        }
    })
    });
// FIN BOTÓN SALIR



</script>